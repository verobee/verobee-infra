- name: Setup VLAN 10 on enp1s0 interface and assign IP address
  hosts: all
  become: yes
  tasks:
    - name: Create VLAN 10 on enp1s0 interface
      command:
        cmd: "ip link add link enp1s0 name enp1s0.10 type vlan id 10"
        creates: "/sys/class/net/enp1s0.10"
    
    - name: Set VLAN 10 interface up
      command:
        cmd: "ip link set enp1s0.10 up"

    - name: Assign IP address 192.168.10.1/24 to enp1s0.10 interface
      command:
        cmd: "ip addr add 192.168.10.1/24 dev enp1s0.10"
        creates: "/sys/class/net/enp1s0.10/address"

    - name: Verify VLAN 10 interface status
      command:
        cmd: "ip addr show enp1s0.10"

    - name: Save the changes (persistent configuration)
      copy:
        dest: "/etc/network/interfaces.d/50-vlan10.cfg"
        content: |
          auto enp1s0.10
          iface enp1s0.10 inet static
          address 192.168.10.1
          netmask 255.255.255.0
          vlan_raw_device enp1s0
        owner: root
        group: root
        mode: '0644'